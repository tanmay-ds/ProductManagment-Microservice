package com.productmanagment.userinfo.config;

import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.mongodb.core.MongoTemplate;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;

import com.github.cloudyrock.mongock.driver.mongodb.springdata.v3.SpringDataMongoV3Driver;

import io.changock.runner.spring.v5.ChangockSpring5;
import io.changock.runner.spring.v5.SpringInitializingBeanRunner;

@Configuration
public class UserDatabaseConfig {
	
	@Bean
	public PasswordEncoder getPasswordEncoder() {
		return new BCryptPasswordEncoder();
	}
	
	@Bean
	public SpringInitializingBeanRunner mongock(
	        ApplicationContext springContext,
	        MongoTemplate mongoTemplate){
		return ChangockSpring5.builder()
		        .setDriver(SpringDataMongoV3Driver.withDefaultLock(mongoTemplate))
		        .addChangeLogsScanPackage("com.productmanagment.userinfo.config.changlog")
		        .setSpringContext(springContext)
		        .buildInitializingBeanRunner();
	  }

}
