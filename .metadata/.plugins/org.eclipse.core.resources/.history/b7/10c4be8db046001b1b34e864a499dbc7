package com.productmanagment.userinfo.service.impl;

import java.security.InvalidKeyException;
import java.security.NoSuchAlgorithmException;

import javax.crypto.BadPaddingException;
import javax.crypto.IllegalBlockSizeException;
import javax.crypto.NoSuchPaddingException;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.stereotype.Service;

import com.productmanagment.userinfo.dto.Dtos;
import com.productmanagment.userinfo.entity.UserInfo;
import com.productmanagment.userinfo.exceptionhandler.BadCredsException;
import com.productmanagment.userinfo.model.MyUserDetails;
import com.productmanagment.userinfo.repo.UserInfoRepository;


@Service
public class MyUserDetailsServiceImpl implements UserDetailsService {

	@Autowired
	UserInfoRepository userInfoRepository;

	@Autowired
	Dtos dtos;

	@Value("${key}")
	private String key;

	@Override
	public UserDetails loadUserByUsername(String username) {
		UserInfo decryptedUser = null;
		try {
			decryptedUser = dtos.decrypt(userInfoRepository.findByEncryptEmail(username, key));
		} catch (InvalidKeyException | NoSuchAlgorithmException | NoSuchPaddingException | IllegalBlockSizeException
				| BadPaddingException | NullPointerException e1) {
			throw new BadCredsException("Incorrect username or password");
		}

		return new MyUserDetails(decryptedUser);
	}

}